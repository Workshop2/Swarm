<html>
<head>
	<script type="text/javascript" src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
	<script type="text/javascript" src="js/two.js"></script>
</head> 
<body>
	<div id="canvas" style="background: black"></div>
	<script type="text/javascript">
        var elem = document.getElementById('canvas');
        var playArea = {
            width: 1200,
            height: 480
        };

        var two = new Two(playArea).appendTo(elem);
    	two.play();

		var targeDot = CreateDot(two, playArea, 'red');
		var target = CreateTarget(targeDot, playArea);

    	var dots = [];
    	for(var i = 0; i < 64; i ++){
    		var dot = CreateDot(two, playArea);
    		var bee = CreateBee(dot, playArea);
    		dots.push(bee);
    	}

    	two.bind('update', function () {
    		target.update();

			for(var i = 0; i < dots.length; i++) {
				var pos = dots[i].update(target);		
			}
    	});

    	function CreateDot(two, playArea, colour) {
			var x = 0,//(playArea.width / 2) - 50 + Random(1, 150),
				y = 0,//(playArea.height /2) - 50 + Random(1, 100),
				size = 2;

	    	var dot = two.makeCircle(x, y, size);
	    	dot.fill = colour || 'yellow';

	    	return dot;
    	}

    	function GetRandomPosition(playArea) {
    		var degrees = Random(1, 360);
    		var radians = ToRadians(degrees);
    		var radius = Random(1, 100);
			var x = playArea.width  / 2 + (Math.cos(radians) * radius);
			var y = playArea.height / 2 + (Math.sin(radians) * radius);

			return { x: x, y: y };
    	}

    	function CreateBee(dot, playArea) {
    		var velocity = {x: 0.0, y:0.0},
    			acceleration = {x: 0.0, y:0.0},
    			position = GetRandomPosition(playArea);    			

    		return {
				dot: dot,
				update: function(targetDot) {
					var target = targetDot.translation;

					var dx = target.x - position.x;
					var dy = target.y - position.y;
					var distance = Math.sqrt((dx * dx) + (dy * dy));

					var accelerationRate = distance * 0.00004;
					acceleration.x = dx * accelerationRate;
					acceleration.y = dy * accelerationRate;

					velocity.x = velocity.x + acceleration.x;
					velocity.y = velocity.y + acceleration.y;

					position.x += velocity.x;
					position.y += velocity.y;

					dot.translation.set(position.x, position.y);

					//accelerationRate*= 1.00001;
				}
    		};
    	}

    	function CreateTarget(dot, playArea) {
			return {
				translation: pos = dot.translation,
				degrees: degrees = 0,
				update: function(){
					degrees++;

					// move target in a lovely circle (Thanks James)
					var radians = ToRadians(degrees); // convert degrees to radians
					pos.x = playArea.width  / 2 + (Math.cos(radians) * 100);
					pos.y = playArea.height / 2 + (Math.sin(radians) * 50);
				}
    		};
    	}

    	function Random(min, max) {
    		return Math.floor((Math.random() * max) + min);
    	}

    	function ToRadians(degrees) {
    		return degrees * Math.PI / 180;
    	}

    	function GetAngleBetween(self, target) {
			return Math.atan2(target.y - self.y, target.x - self.x);
    	}

    	function GetRadiansBetween(self, target) {
			return ToRadians(GetAngleBetween(self, target));
    	}

    	/*function SpaceMovement(entity, variables) {

		    entity = $.extend({}, { x: 0, y: 0, rotation: 0 }, entity);

		    var consts = {
		        moveSpeed: 0.05,
		        rotationSpeed: 0.04,
		        velocityDrag: 0.998,
		        rotationDrag: 0.940,
		        maxSpeed: 4,
		        turnSpeed: 5.25
		    };

		    variables = $.extend({}, {
		        velocityX: 0,
		        velocityY: 0,
		        velocityRotation: 0
		    }, variables);

		    var target = null;

	    	var rotateTowards = function(newTarget) {
    			target = newTarget;
	    	};

    		var rotate = function(){
				if(target == null){
					return;
				}

				var radiansToTarget = GetRadiansBetween(entity, target),
					cos = Math.cos(radiansToTarget),
					sin = Math.sin(radiansToTarget)

    		};

		    var rotateLeft = function () {
		        variables.velocityRotation = -consts.rotationSpeed;
		    };

		    var rotateRight = function () {
		        variables.velocityRotation = consts.rotationSpeed;
		    };

		    var accelerate = function () {
		        // where the magic happens
		        if (variables.velocityX < consts.maxSpeed && variables.velocityX > -consts.maxSpeed)
		            variables.velocityX += Math.cos(entity.rotation) * consts.moveSpeed;

		        if (variables.velocityY < consts.maxSpeed && variables.velocityY > -consts.maxSpeed)
		            variables.velocityY += Math.sin(entity.rotation) * consts.moveSpeed;
		    };

		    var update = function () {
		        entity.x += variables.velocityX;
		        entity.y += variables.velocityY;

		        // apply drag to the ship
		        variables.velocityX *= consts.velocityDrag;
		        variables.velocityY *= consts.velocityDrag;
		        
		        rotate();
		        //entity.rotation += variables.velocityRotation;
		        //variables.velocityRotation *= consts.rotationDrag;

		        return entity;
		    };

		    return {
		        rotateLeft: rotateLeft,
		        rotateRight: rotateRight,
		        accelerate: accelerate,
		        update: update,
		        rotateTowards: rotateTowards
		    };
		};*/
    </script>
</body>
</html>